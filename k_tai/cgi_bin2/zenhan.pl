%zen2han = (
	"\x81\x40"," ",
	"\x81\x49","!",
	"\x81\x68","\"",
	"\x81\x67","\"",
	"\x81\x94","#",
	"\x81\x90","\$",
	"\x81\x93","%",
	"\x81\x95","&",
	"\x81\x66","'",
	"\x81\x69","(",
	"\x81\x6a",")",
	"\x81\x96","*",
	"\x81\x7b","+",
	"\x81\x43",",",
	"\x81\x7c","-",
	"\x81\x44",".",
	"\x81\x5e","/",
	"\x82\x4f","0",
	"\x82\x50","1",
	"\x82\x51","2",
	"\x82\x52","3",
	"\x82\x53","4",
	"\x82\x54","5",
	"\x82\x55","6",
	"\x82\x56","7",
	"\x82\x57","8",
	"\x82\x58","9",
	"\x81\x46",":",
	"\x81\x47",";",
	"\x81\x83","<",
	"\x81\x81","=",
	"\x81\x84",">",
	"\x81\x48","?",
	"\x81\x97","@",
	"\x82\x60","A",
	"\x82\x61","B",
	"\x82\x62","C",
	"\x82\x63","D",
	"\x82\x64","E",
	"\x82\x65","F",
	"\x82\x66","G",
	"\x82\x67","H",
	"\x82\x68","I",
	"\x82\x69","J",
	"\x82\x6a","K",
	"\x82\x6b","L",
	"\x82\x6c","M",
	"\x82\x6d","N",
	"\x82\x6e","O",
	"\x82\x6f","P",
	"\x82\x70","Q",
	"\x82\x71","R",
	"\x82\x72","S",
	"\x82\x73","T",
	"\x82\x74","U",
	"\x82\x75","V",
	"\x82\x76","W",
	"\x82\x77","X",
	"\x82\x78","Y",
	"\x82\x79","Z",
	"\x81\x6d","[",
	"\x81\x8f","\\",
	"\x81\x6e","]",
	"\x81\x4f","^",
	"\x81\x51","_",
	"\x81\x65","`",
	"\x82\x81","a",
	"\x82\x82","b",
	"\x82\x83","c",
	"\x82\x84","d",
	"\x82\x85","e",
	"\x82\x86","f",
	"\x82\x87","g",
	"\x82\x88","h",
	"\x82\x89","i",
	"\x82\x8a","j",
	"\x82\x8b","k",
	"\x82\x8c","l",
	"\x82\x8d","m",
	"\x82\x8e","n",
	"\x82\x8f","o",
	"\x82\x90","p",
	"\x82\x91","q",
	"\x82\x92","r",
	"\x82\x93","s",
	"\x82\x94","t",
	"\x82\x95","u",
	"\x82\x96","v",
	"\x82\x97","w",
	"\x82\x98","x",
	"\x82\x99","y",
	"\x82\x9a","z",
	"\x81\x6f","{",
	"\x81\x62","|",
	"\x81\x70","}",
	"\x81\x60","~",
	"\x83\x4b","\xB6\xDE",
	"\x83\x4d","\xB7\xDE",
	"\x83\x4f","\xB8\xDE",
	"\x83\x51","\xB9\xDE",
	"\x83\x53","\xBA\xDE",
	"\x83\x55","\xBB\xDE",
	"\x83\x57","\xBC\xDE",
	"\x83\x59","\xBD\xDE",
	"\x83\x5b","\xBE\xDE",
	"\x83\x5d","\xBF\xDE",
	"\x83\x5f","\xC0\xDE",
	"\x83\x61","\xC1\xDE",
	"\x83\x64","\xC2\xDE",
	"\x83\x66","\xC3\xDE",
	"\x83\x68","\xC4\xDE",
	"\x83\x6f","\xCA\xDE",
	"\x83\x72","\xCB\xDE",
	"\x83\x75","\xCC\xDE",
	"\x83\x78","\xCD\xDE",
	"\x83\x7b","\xCE\xDE",
	"\x83\x70","\xCA\xDF",
	"\x83\x73","\xCB\xDF",
	"\x83\x76","\xCC\xDF",
	"\x83\x79","\xCD\xDF",
	"\x83\x7c","\xCE\xDF",
	"\x81\x42","\xA1",
	"\x81\x75","\xA2",
	"\x81\x76","\xA3",
	"\x81\x41","\xA4",
	"\x81\x45","\xA5",
	"\x83\x92","\xA6",
	"\x83\x40","\xA7",
	"\x83\x42","\xA8",
	"\x83\x44","\xA9",
	"\x83\x46","\xAA",
	"\x83\x48","\xAB",
	"\x83\x83","\xAC",
	"\x83\x85","\xAD",
	"\x83\x87","\xAE",
	"\x83\x62","\xAF",
	"\x81\x5b","\xB0",
	"\x83\x41","\xB1",
	"\x83\x43","\xB2",
	"\x83\x45","\xB3",
	"\x83\x47","\xB4",
	"\x83\x49","\xB5",
	"\x83\x4a","\xB6",
	"\x83\x4c","\xB7",
	"\x83\x4e","\xB8",
	"\x83\x50","\xB9",
	"\x83\x52","\xBA",
	"\x83\x54","\xBB",
	"\x83\x56","\xBC",
	"\x83\x58","\xBD",
	"\x83\x5a","\xBE",
	"\x83\x5c","\xBF",
	"\x83\x5e","\xC0",
	"\x83\x60","\xC1",
	"\x83\x63","\xC2",
	"\x83\x65","\xC3",
	"\x83\x67","\xC4",
	"\x83\x69","\xC5",
	"\x83\x6a","\xC6",
	"\x83\x6b","\xC7",
	"\x83\x6c","\xC8",
	"\x83\x6d","\xC9",
	"\x83\x6e","\xCA",
	"\x83\x71","\xCB",
	"\x83\x74","\xCC",
	"\x83\x77","\xCD",
	"\x83\x7a","\xCE",
	"\x83\x7d","\xCF",
	"\x83\x7e","\xD0",
	"\x83\x80","\xD1",
	"\x83\x81","\xD2",
	"\x83\x82","\xD3",
	"\x83\x84","\xD4",
	"\x83\x86","\xD5",
	"\x83\x88","\xD6",
	"\x83\x89","\xD7",
	"\x83\x8a","\xD8",
	"\x83\x8b","\xD9",
	"\x83\x8c","\xDA",
	"\x83\x8d","\xDB",
	"\x83\x8f","\xDC",
	"\x83\x93","\xDD",
	"\x81\x4a","\xDE",
	"\x81\x4b","\xDF"
);

%han2zen = (
	" ","\x81\x40",
	"!","\x81\x49",
	"\"","\x81\x68",
	"#","\x81\x94",
	"\$","\x81\x90",
	"%","\x81\x93",
	"&","\x81\x95",
	"'","\x81\x66",
	"(","\x81\x69",
	")","\x81\x6a",
	"*","\x81\x96",
	"+","\x81\x7b",
	",","\x81\x43",
	"-","\x81\x7c",
	".","\x81\x44",
	"/","\x81\x5e",
	"0","\x82\x4f",
	"1","\x82\x50",
	"2","\x82\x51",
	"3","\x82\x52",
	"4","\x82\x53",
	"5","\x82\x54",
	"6","\x82\x55",
	"7","\x82\x56",
	"8","\x82\x57",
	"9","\x82\x58",
	":","\x81\x46",
	";","\x81\x47",
	"<","\x81\x83",
	"=","\x81\x81",
	">","\x81\x84",
	"?","\x81\x48",
	"@","\x81\x97",
	"A","\x82\x60",
	"B","\x82\x61",
	"C","\x82\x62",
	"D","\x82\x63",
	"E","\x82\x64",
	"F","\x82\x65",
	"G","\x82\x66",
	"H","\x82\x67",
	"I","\x82\x68",
	"J","\x82\x69",
	"K","\x82\x6a",
	"L","\x82\x6b",
	"M","\x82\x6c",
	"N","\x82\x6d",
	"O","\x82\x6e",
	"P","\x82\x6f",
	"Q","\x82\x70",
	"R","\x82\x71",
	"S","\x82\x72",
	"T","\x82\x73",
	"U","\x82\x74",
	"V","\x82\x75",
	"W","\x82\x76",
	"X","\x82\x77",
	"Y","\x82\x78",
	"Z","\x82\x79",
	"[","\x81\x6d",
	"\\","\x81\x8f",
	"]","\x81\x6e",
	"^","\x81\x4f",
	"_","\x81\x51",
	"`","\x81\x65",
	"a","\x82\x81",
	"b","\x82\x82",
	"c","\x82\x83",
	"d","\x82\x84",
	"e","\x82\x85",
	"f","\x82\x86",
	"g","\x82\x87",
	"h","\x82\x88",
	"i","\x82\x89",
	"j","\x82\x8a",
	"k","\x82\x8b",
	"l","\x82\x8c",
	"m","\x82\x8d",
	"n","\x82\x8e",
	"o","\x82\x8f",
	"p","\x82\x90",
	"q","\x82\x91",
	"r","\x82\x92",
	"s","\x82\x93",
	"t","\x82\x94",
	"u","\x82\x95",
	"v","\x82\x96",
	"w","\x82\x97",
	"x","\x82\x98",
	"y","\x82\x99",
	"z","\x82\x9a",
	"{","\x81\x6f",
	"|","\x81\x62",
	"}","\x81\x70",
	"~","\x81\x60",
	"\xB6\xDE","\x83\x4b",
	"\xB7\xDE","\x83\x4d",
	"\xB8\xDE","\x83\x4f",
	"\xB9\xDE","\x83\x51",
	"\xBA\xDE","\x83\x53",
	"\xBB\xDE","\x83\x55",
	"\xBC\xDE","\x83\x57",
	"\xBD\xDE","\x83\x59",
	"\xBE\xDE","\x83\x5b",
	"\xBF\xDE","\x83\x5d",
	"\xC0\xDE","\x83\x5f",
	"\xC1\xDE","\x83\x61",
	"\xC2\xDE","\x83\x64",
	"\xC3\xDE","\x83\x66",
	"\xC4\xDE","\x83\x68",
	"\xCA\xDE","\x83\x6f",
	"\xCB\xDE","\x83\x72",
	"\xCC\xDE","\x83\x75",
	"\xCD\xDE","\x83\x78",
	"\xCE\xDE","\x83\x7b",
	"\xCA\xDF","\x83\x70",
	"\xCB\xDF","\x83\x73",
	"\xCC\xDF","\x83\x76",
	"\xCD\xDF","\x83\x79",
	"\xCE\xDF","\x83\x7c",
	"\xA1","\x81\x42",
	"\xA2","\x81\x75",
	"\xA3","\x81\x76",
	"\xA4","\x81\x41",
	"\xA5","\x81\x45",
	"\xA6","\x83\x92",
	"\xA7","\x83\x40",
	"\xA8","\x83\x42",
	"\xA9","\x83\x44",
	"\xAA","\x83\x46",
	"\xAB","\x83\x48",
	"\xAC","\x83\x83",
	"\xAD","\x83\x85",
	"\xAE","\x83\x87",
	"\xAF","\x83\x62",
	"\xB0","\x81\x5b",
	"\xB1","\x83\x41",
	"\xB2","\x83\x43",
	"\xB3","\x83\x45",
	"\xB4","\x83\x47",
	"\xB5","\x83\x49",
	"\xB6","\x83\x4a",
	"\xB7","\x83\x4c",
	"\xB8","\x83\x4e",
	"\xB9","\x83\x50",
	"\xBA","\x83\x52",
	"\xBB","\x83\x54",
	"\xBC","\x83\x56",
	"\xBD","\x83\x58",
	"\xBE","\x83\x5a",
	"\xBF","\x83\x5c",
	"\xC0","\x83\x5e",
	"\xC1","\x83\x60",
	"\xC2","\x83\x63",
	"\xC3","\x83\x65",
	"\xC4","\x83\x67",
	"\xC5","\x83\x69",
	"\xC6","\x83\x6a",
	"\xC7","\x83\x6b",
	"\xC8","\x83\x6c",
	"\xC9","\x83\x6d",
	"\xCA","\x83\x6e",
	"\xCB","\x83\x71",
	"\xCC","\x83\x74",
	"\xCD","\x83\x77",
	"\xCE","\x83\x7a",
	"\xCF","\x83\x7d",
	"\xD0","\x83\x7e",
	"\xD1","\x83\x80",
	"\xD2","\x83\x81",
	"\xD3","\x83\x82",
	"\xD4","\x83\x84",
	"\xD5","\x83\x86",
	"\xD6","\x83\x88",
	"\xD7","\x83\x89",
	"\xD8","\x83\x8a",
	"\xD9","\x83\x8b",
	"\xDA","\x83\x8c",
	"\xDB","\x83\x8d",
	"\xDC","\x83\x8f",
	"\xDD","\x83\x93",
	"\xDE","\x81\x4a",
	"\xDF","\x81\x4b"
);

sub zen2han {
	local($str) = @_;
	return(&zenhan($str, 1));
}

sub han2zen {
	local($str) = @_;
	return(&zenhan($str, 0));
}

sub zenhan {
	local($str, $flag) = @_;
	local($i, $c);
	local(@str) = ();
	for ($i=0; $i<length($str); $i++) {
		$c = substr($str, $i, 1);
		if ($cc ne "") {
			if ((&code($cc) >= 0xb6 && &code($cc) <= 0xce) &&
			    (&code($c) != 0xde && &code($c) != 0xdf)) {
				push(@str, $cc);
				if ((&code($c) >= 0x81 && &code($c) <= 0x9f) ||
			        (&code($c) >= 0xe0 && &code($c) <= 0xef) ||
			        (&code($c) >= 0xb6 && &code($c) <= 0xce)) {
					$cc = $c;
				} else {
					push(@str, $c);
					$cc = "";
				}
			} else {
				push(@str, $cc . $c);
				$cc = "";
			}
		} elsif ((&code($c) >= 0x81 && &code($c) <= 0x9f) ||
		         (&code($c) >= 0xe0 && &code($c) <= 0xef) ||
		         (&code($c) >= 0xb6 && &code($c) <= 0xce)) {
			$cc = $c;
		} else {
			push(@str, $c);
		}
	}
	if ($cc ne "") {
		push(@str, $cc);
	}
	$str = "";
	foreach (@str) {
		if ($flag) {
			if ($zen2han{$_} ne "") {
				$str .= $zen2han{$_};
			} else {
				$str .= $_;
			}
		} else {
			if ($han2zen{$_} ne "") {
				$str .= $han2zen{$_};
			} else {
				$str .= $_;
			}
		}
	}
	return($str);
}

sub s2u {
	local($num) = @_;
	if ($num < 0) {
		$num += 256;
	}
	return($num);
}

sub code {
	local($char) = @_;
	return(&s2u(unpack("c",$char)));
}
